<!doctype html>
<html>
<head>
    <title>realXtend WebTundra</title>
    <meta charset="utf-8" />

    <!-- CSS -->
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">

    <style type="text/css">
    html {
        margin: 0px; padding: 0px; overflow: hidden;
    }
    body {
        position: absolute; padding: 0px; margin: 0px; width: 100%; height: 100%; overflow: hidden;
    }
    #webrocket-container-custom {
        position: absolute; background-color: black; width: 100%; height: 100%;
    }
    </style>
</head>
<body>

<script src="realxtend-webtundra-sdk.js"></script>

<div id="webtundra-container-custom"></div>

<script>
    var client = tundra.createWebTundraClient({
        container    : "#webtundra-container-custom",
        renderSystem : ThreeJsRenderer
    });

    // Run application. EC_Script is not yet implemented in the WebTundra SDK
    // so we are just going to ensure the scripts dependencies here and run it.
    $.getScript("application/freecamera.js")
        .done(function( script, textStatus ) {
            var freecamera = new FreeCameraApplication();
        })
        .fail(function( jqxhr, settings, exception ) {
            console.error(exception);
        }
    );

    // Create login widgets
    var loginControls = $("<div/>", {
        id      : "login-controls"
    });
    var loginHost = $("<input/>", {
        id      : "login-host",
        type    : "text",
        value   : "ws://127.0.0.1:2345"
    });
    var loginUsername = $("<input/>", {
        id      : "login-username",
        type    : "text",
        value   : "WebTundra User"
    });
    var loginButton = $("<button/>", {
        id : "login-button",
        text : "Connect",
        css : {
            "font-size"   : 12,
        }
    }).button();

    loginControls.css({
        "position"  : "absolute",
        "top"       : 160,
        "left"      : 0,
        "width"     : "100%",
        "padding"   : 10,
        "border"    : 0,
        "z-index"   : 6,
        "text-align"  : "center",
        "font-family" : "Arial",
        "font-size"   : 14,
        "font-weight" : "bold",
        "background-color" : "transparent"
    });

    var inputs = [ loginHost, loginUsername, loginButton ];
    for (var i = 0; i < inputs.length; i++)
    {
        inputs[i].css({
            "min-width"     : 100,
            "max-height"    : 25,
            "margin-left"   : 6,
            "margin-right"  : 9,
            "padding"       : inputs[i] === loginButton ? 0 : 3,
            "border"        : "1px solid lightgrey",
            "border-radius" : 4
        });
    }

    loginControls.append("Host");
    loginControls.append(loginHost);
    loginControls.append("Username");
    loginControls.append(loginUsername);
    loginControls.append(loginButton);
    loginControls.fadeIn(1000);

    client.ui.addWidgetToScene(loginControls);

    loginButton.click(function() {
        if (!client.isConnected())
            client.connect(loginHost.val(), { username: loginUsername.val() });
        else
            client.disconnect();
    });

    // Connected to server
    client.onConnected(null, function() {
        loginHost.attr("disabled", "disabled");
        loginUsername.attr("disabled", "disabled");
        loginButton.text("Disconnect");
        loginControls.hide();

        client.ui.hideLoadingScreen();
    });

    // Disconnected from server
    client.onDisconnected(null, function() {
        loginHost.removeAttr("disabled");
        loginUsername.removeAttr("disabled");
        loginButton.text("Connect");
        loginControls.fadeIn(1000);
    });
</script>
</body>
</html>
